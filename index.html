<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Biopsychosocial Integrated Screening Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f7f7;
    }
    h1 {
      text-align: center;
    }
    fieldset {
      border: 1px solid #ccc;
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
    }
    legend {
      font-weight: bold;
    }
    label {
      display: block;
      margin: 8px 0 4px;
    }
    select, input[type="number"], input[type="text"], input[type="radio"] {
      margin-right: 10px;
    }
    .hidden {
      display: none;
    }
    .question {
      margin-bottom: 10px;
    }
    .btn {
      padding: 10px 20px;
      background: #0073e6;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    .btn:disabled {
      background: #999;
    }
    #results {
      margin-top: 20px;
      padding: 15px;
      background: #e8f4ff;
      border: 1px solid #0073e6;
    }
    @media print {
      .no-print {
        display: none;
      }
      body {
        background: #fff;
      }
    }
  </style>
</head>
<body>
  <h1>10-Minute Integrated Biopsychosocial Screening</h1>
  <p>Patient ID: <input type="text" id="patientId" /> Date: <input type="date" id="screenDate" /></p>

  <!-- Demographics -->
  <fieldset>
    <legend>Demographics</legend>
    <div class="question">
      <label>Sex at birth:</label>
      <label><input type="radio" name="sex" value="male" /> Male</label>
      <label><input type="radio" name="sex" value="female" /> Female</label>
      <label><input type="radio" name="sex" value="intersex" /> Intersex</label>
    </div>
  </fieldset>

  <!-- Section A: Substance Use -->
  <fieldset>
    <legend>A. Substance Use</legend>
    <div class="question">
      <label>1. How often did you have a drink containing alcohol in the past 12 months?</label>
      <select id="audit1">
        <option value="0">Never</option>
        <option value="1">Monthly or less</option>
        <option value="2">2-4 times a month</option>
        <option value="3">2-3 times a week</option>
        <option value="4">4+ times a week</option>
      </select>
    </div>
    <div class="question">
      <label>2. How many standard drinks containing alcohol do you have on a typical day?</label>
      <select id="audit2">
        <option value="0">1-2</option>
        <option value="1">3-4</option>
        <option value="2">5-6</option>
        <option value="3">7-9</option>
        <option value="4">10+</option>
      </select>
    </div>
    <div class="question">
      <label>3. How often do you have six or more drinks on one occasion?</label>
      <select id="audit3">
        <option value="0">Never</option>
        <option value="1">Less than monthly</option>
        <option value="2">Monthly</option>
        <option value="3">Weekly</option>
        <option value="4">Daily or almost daily</option>
      </select>
    </div>
    <div class="question">
      <label>4. In the past year, how many times have you used an illegal drug or used a prescription medication for non-medical reasons <em>(for example, because of the feeling it caused)</em>?</label>
      <select id="nida">
        <option value="0">0 times</option>
        <option value="1">1 or more times</option>
      </select>
    </div>

    <!-- SIP-DU follow-up (shows only if NIDA positive) -->
    <div id="sipDuBlock" class="hidden" style="margin-top:10px;">
      <p><strong>Follow-up (SIP-DU – Drug Use Consequences):</strong> Have you ever experienced any of the following because of your drug use? (Select Yes or No for each)</p>
      <label>a. Failed to do what was normally expected of you (work, school, home)?</label>
      <select id="sip1"><option value="0">No</option><option value="1">Yes</option></select>
      <label>b. Had arguments or problems with family, friends, or co-workers?</label>
      <select id="sip2"><option value="0">No</option><option value="1">Yes</option></select>
      <label>c. Got into situations that increased your chances of being hurt (e.g., driving under the influence)?</label>
      <select id="sip3"><option value="0">No</option><option value="1">Yes</option></select>
      <label>d. Continued to use drugs even though they were causing you health, legal, or social problems?</label>
      <select id="sip4"><option value="0">No</option><option value="1">Yes</option></select>
      <label>e. Wanted or tried to cut down or stop using drugs but were unable?</label>
      <select id="sip5"><option value="0">No</option><option value="1">Yes</option></select>
    </div>

    <!-- Lifetime substance checklist -->
    <div id="substanceBlock" class="hidden" style="margin-top:10px;">
      <p><strong>Which of the following substances have you ever used in your lifetime?</strong> <em>(Check all that apply; non-medical use only*)</em></p>
      <label><input type="checkbox" id="sub1" /> a. Cannabis (marijuana, pot, grass, hash)</label>
      <label><input type="checkbox" id="sub2" /> b. Cocaine (coke, crack)</label>
      <label><input type="checkbox" id="sub3" /> c. Prescription stimulants* (Ritalin, Adderall, diet pills)</label>
      <label><input type="checkbox" id="sub4" /> d. Methamphetamine (speed, ice)</label>
      <label><input type="checkbox" id="sub5" /> e. Inhalants (nitrous, glue, gas, paint thinner)</label>
      <label><input type="checkbox" id="sub6" /> f. Sedatives or sleeping pills* (Valium, Xanax)</label>
      <label><input type="checkbox" id="sub7" /> g. Hallucinogens (LSD, mushrooms, PCP, ecstasy)</label>
      <label><input type="checkbox" id="sub8" /> h. Street opioids (heroin, opium)</label>
      <label><input type="checkbox" id="sub9" /> i. Prescription opioids* (fentanyl, oxycodone, hydrocodone)</label>
      <label><input type="checkbox" id="subOther" /> j. Other — specify: <input type="text" id="otherText" placeholder="Substance" style="width:150px;" /></label>
      <p style="font-size:0.9em;">*Report non-medical use only.</p>
    </div>
  </fieldset>

  <!-- Section B: Mental Health -->
  <fieldset>
    <legend>B. Mental Health</legend>
    <div class="question">
      <label>During the past 2 weeks, how often have you been bothered by any of the following problems?</label>
      <label>5. Little interest or pleasure in doing things</label>
      <select id="phq1">
        <option value="0">Not at all</option>
        <option value="1">Several days</option>
        <option value="2">More than half the days</option>
        <option value="3">Nearly every day</option>
      </select>
      <label>6. Feeling down, depressed, or hopeless</label>
      <select id="phq2">
        <option value="0">Not at all</option>
        <option value="1">Several days</option>
        <option value="2">More than half the days</option>
        <option value="3">Nearly every day</option>
      </select>
      <label>7. Feeling nervous, anxious, or on edge</label>
      <select id="gad1">
        <option value="0">Not at all</option>
        <option value="1">Several days</option>
        <option value="2">More than half the days</option>
        <option value="3">Nearly every day</option>
      </select>
      <label>8. Not being able to stop or control worrying</label>
      <select id="gad2">
        <option value="0">Not at all</option>
        <option value="1">Several days</option>
        <option value="2">More than half the days</option>
        <option value="3">Nearly every day</option>
      </select>
      <!-- ASQ Suicide Screening -->
      <div id="asqBlock" style="margin-top:15px; border-top:1px dashed #888; padding-top:10px;">
        <p><strong>Suicide Risk (ASQ – Ask Suicide-Screening Questions)</strong></p>
        <label>9. In the past few weeks, have you wished you were dead?
          <select id="asq1"><option value="0">No</option><option value="1">Yes</option></select>
        </label>
        <label>10. In the past few weeks, have you felt that you or your family would be better off if you were dead?
          <select id="asq2"><option value="0">No</option><option value="1">Yes</option></select>
        </label>
        <label>11. In the past week, have you been having thoughts about killing yourself?
          <select id="asq3"><option value="0">No</option><option value="1">Yes</option></select>
        </label>
        <label>12. Have you ever tried to kill yourself?
          <select id="asq4"><option value="0">No</option><option value="1">Yes</option></select>
        </label>
        <!-- Acuity probe -->
        <label id="asq5wrap" class="hidden">Are you having thoughts of killing yourself <em>right now</em>?
          <select id="asq5"><option value="0">No</option><option value="1">Yes</option></select>
        </label>
      </div>

      <!-- PHQ-9 extension (shows only if PHQ-2 ≥3) -->
      <div id="phq9Block" class="hidden">
        <p><strong>Additional questions (PHQ-9):</strong> Over the past 2 weeks, how often have you been bothered by…</p>
        <label>9. Trouble falling or staying asleep, or sleeping too much</label>
        <select id="phq3">
          <option value="0">Not at all</option>
          <option value="1">Several days</option>
          <option value="2">More than half the days</option>
          <option value="3">Nearly every day</option>
        </select>
        <label>10. Feeling tired or having little energy</label>
        <select id="phq4">
          <option value="0">Not at all</option>
          <option value="1">Several days</option>
          <option value="2">More than half the days</option>
          <option value="3">Nearly every day</option>
        </select>
        <label>11. Poor appetite or overeating</label>
        <select id="phq5">
          <option value="0">Not at all</option>
          <option value="1">Several days</option>
          <option value="2">More than half the days</option>
          <option value="3">Nearly every day</option>
        </select>
        <label>12. Feeling bad about yourself — or that you are a failure or have let yourself or your family down</label>
        <select id="phq6">
          <option value="0">Not at all</option>
          <option value="1">Several days</option>
          <option value="2">More than half the days</option>
          <option value="3">Nearly every day</option>
        </select>
        <label>13. Trouble concentrating on things, such as reading the newspaper or watching television</label>
        <select id="phq7">
          <option value="0">Not at all</option>
          <option value="1">Several days</option>
          <option value="2">More than half the days</option>
          <option value="3">Nearly every day</option>
        </select>
        <label>14. Moving or speaking so slowly that other people could have noticed? Or the opposite — being so fidgety or restless that you have been moving a lot more than usual</label>
        <select id="phq8">
          <option value="0">Not at all</option>
          <option value="1">Several days</option>
          <option value="2">More than half the days</option>
          <option value="3">Nearly every day</option>
        </select>
        <label>15. Thoughts that you would be better off dead or of hurting yourself in some way</label>
        <select id="phq9">
          <option value="0">Not at all</option>
          <option value="1">Several days</option>
          <option value="2">More than half the days</option>
          <option value="3">Nearly every day</option>
        </select>
      </div>
    </div>

    <!-- Section C: Trauma & PTSD -->
    <fieldset>
      <legend>C. Trauma & PTSD (PC-PTSD-5)</legend>
      <p>Have you ever experienced any event that was so frightening, horrible, or upsetting that, in the past month…</p>
      <div class="question">
        <label>9. You had nightmares or thought about it when you did not want to?</label>
        <select id="ptsd1"><option value="0">No</option><option value="1">Yes</option></select>
      </div>
      <div class="question">
        <label>10. Tried hard not to think about it or went out of your way to avoid situations that reminded you of it?</label>
        <select id="ptsd2"><option value="0">No</option><option value="1">Yes</option></select>
      </div>
      <div class="question">
        <label>11. Were constantly on guard, watchful, or easily startled?</label>
        <select id="ptsd3"><option value="0">No</option><option value="1">Yes</option></select>
      </div>
      <div class="question">
        <label>12. Felt numb or detached from people, activities, or your surroundings?</label>
        <select id="ptsd4"><option value="0">No</option><option value="1">Yes</option></select>
      </div>
      <div class="question">
        <label>13. Felt guilty or unable to stop blaming yourself or others for the event or any problems the event may have caused?</label>
        <select id="ptsd5"><option value="0">No</option><option value="1">Yes</option></select>
      </div>
    </fieldset>

    <!-- Section D: Cognitive Screening -->
    <fieldset>
      <legend>D. Cognitive Screening</legend>
      <!-- Cognitive Quick Screen (Six-Item Screener + Attention) -->
      <div id="cogBlock">
        <p><strong>Cognitive Quick Screen</strong> <span style="font-size:0.9em;">(Six-Item Screener + Attention)</span></p>
        <p style="font-size:0.9em;">Mark “Yes” if patient answers correctly.</p>
        <label>a. What <u>year</u> is it? <input type="number" id="orientYear" style="width:90px;" /></label>
        <label>b. What <u>month</u> is it? (1-12 or name) <input type="text" id="orientMonth" style="width:120px;" /></label>
        <label>c. What <u>day of the week</u> is it? <input type="text" id="orientDOW" style="width:120px;" /></label>
        <p>Remember the words <em>APPLE – TABLE – PENNY</em>. You will be asked to recall them later.</p>
        <hr/>
        <p><strong>Letter Cancellation Attention Test (20 seconds)</strong></p>
        <p>Cross out every letter <strong>A</strong> you see in the grid below <em>in 20 seconds</em>.</p>
        <button type="button" class="btn no-print" id="startLetterTask">Start 20-second letter task</button>
        <span id="timerMsg" style="margin-left:10px; font-size:0.9em;"></span>
        <pre id="letterGrid" style="display:none; font-family:monospace; line-height:1.2; background:#f3f3f3; padding:6px;">
F A L P R   T Q A Y W
G B C A S   N U X A D
J L A V E   I A O H K
M R P Q S   A T C Z A
A N Y G A   P L E B A
        </pre>
        <br/>
        <div id="attWrap" style="display:none;">
          <label>Total errors (omissions + wrong letters): <input type="number" id="attErrors" min="0" value="0" style="width:60px;" /></label>
          <p style="font-size:0.85em;">(3 or more errors suggests attentional impairment.)</p>
        </div>
      </div>
    </fieldset>

    <!-- Section E: Physical & Functional Screening -->
    <fieldset>
      <legend>E. Physical & Functional Screening</legend>
      <h4>General Health & Pain (PEG-3)</h4>
      <label>How would you rate your general health?
        <select id="sf1">
          <option value="1">Excellent</option>
          <option value="2">Very good</option>
          <option value="3">Good</option>
          <option value="4">Fair</option>
          <option value="5">Poor</option>
        </select>
      </label>
      <label>Pain intensity (average past week) (0-10)
        <input type="number" id="peg1" min="0" max="10" value="0" style="width:60px;" />
      </label>
      <label>Pain interference with enjoyment of life (0-10)
        <input type="number" id="peg2" min="0" max="10" value="0" style="width:60px;" />
      </label>
      <label>Pain interference with general activity (0-10)
        <input type="number" id="peg3" min="0" max="10" value="0" style="width:60px;" />
      </label>

      <!-- Mobility / SARC-F -->
      <h4>Mobility (SARC-F)</h4>
      <p>Over the past 6 months, how much difficulty have you had with the following?</p>
      <label>1. Lifting or carrying 10&nbsp;lbs (4.5&nbsp;kg)
        <select id="sarc1"><option value="0">None</option><option value="1">Some</option><option value="2">A lot / Unable</option></select>
      </label>
      <label>2. Walking across a room
        <select id="sarc2"><option value="0">None</option><option value="1">Some</option><option value="2">A lot / Unable</option></select>
      </label>
      <label>3. Rising from a chair
        <select id="sarc3"><option value="0">None</option><option value="1">Some</option><option value="2">A lot / Unable</option></select>
      </label>
      <label>4. Climbing 10 stairs
        <select id="sarc4"><option value="0">None</option><option value="1">Some</option><option value="2">A lot / Unable</option></select>
      </label>
      <label>5. How many falls in the past year?
        <select id="sarc5"><option value="0">0 falls</option><option value="1">1–3 falls</option><option value="2">4 or more</option></select>
      </label>

      <!-- Vision & Hearing -->
      <h4>Vision & Hearing</h4>
      <label>6. Is your eyesight (with glasses) good enough to read newsprint?
        <select id="vision"><option value="0">Yes</option><option value="1">No</option></select>
      </label>
      <label>7. Do you strain to hear a conversation in a quiet room?
        <select id="hearing"><option value="0">No</option><option value="1">Yes</option></select>
      </label>

      <!-- Hygiene, Sleep, Nutrition -->
      <h4>Hygiene, Sleep, Nutrition</h4>
      <label>8. Clinician observation: appears unkempt / poor hygiene
        <select id="hygiene"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>9. During the past month, how would you rate your sleep quality overall?
        <select id="sleepQ"><option value="0">Very good</option><option value="0">Fairly good</option><option value="1">Fairly bad</option><option value="1">Very bad</option></select>
      </label>
      <label>10. Have you unintentionally lost more than 5&nbsp;lbs (2.3&nbsp;kg) in the last 3 months?
        <select id="weightLoss"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>11. Have you eaten fewer than two meals per day for most days in the past week?
        <select id="meals"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>12. Times you have seen a doctor or been in hospital in past 6 months: <input type="number" id="visits" min="0" value="0" style="width:70px;" /></label>

      <!-- ADLs -->
      <h4>Basic Activities of Daily Living (Katz Index)</h4>
      <label>13. Need help to bathe or shower?
        <select id="adl1"><option value="1">No</option><option value="0">Yes</option></select>
      </label>
      <label>14. Need help to dress yourself?
        <select id="adl2"><option value="1">No</option><option value="0">Yes</option></select>
      </label>
      <label>15. Need help to use the toilet?
        <select id="adl3"><option value="1">No</option><option value="0">Yes</option></select>
      </label>
      <label>16. Need help to transfer from bed to chair?
        <select id="adl4"><option value="1">No</option><option value="0">Yes</option></select>
      </label>
      <label>17. Need help to control bowel & bladder?
        <select id="adl5"><option value="1">No</option><option value="0">Yes</option></select>
      </label>
      <label>18. Need help to feed yourself?
        <select id="adl6"><option value="1">No</option><option value="0">Yes</option></select>
      </label>
    </fieldset>

    <!-- Section F: Social Determinants & Functioning -->
    <fieldset>
      <legend>F. Social Determinants & Functioning</legend>
      <div class="question">
        <label>18. Where did you sleep most nights in the past month?</label>
        <select id="housing">
          <option value="0">Stable housing (own/rent)</option>
          <option value="1">Temporary (shelter, doubled-up, hotel)</option>
          <option value="2">Unsheltered (street, vehicle, tent)</option>
        </select>
      </div>
      <div class="question">
        <label>19. Within the past 12 months we worried whether our food would run out before we got money to buy more.</label>
        <select id="food1">
          <option value="0">Never true</option>
          <option value="1">Sometimes true</option>
          <option value="1">Often true</option>
        </select>
      </div>
      <div class="question">
        <label>20. Within the past 12 months the food we bought just didn’t last and we didn’t have money to get more.</label>
        <select id="food2">
          <option value="0">Never true</option>
          <option value="1">Sometimes true</option>
          <option value="1">Often true</option>
        </select>
      </div>
      <div class="question">
        <label>21. In the past 12 months, has lack of transportation kept you from medical appointments, work, or getting things you needed?</label>
        <select id="transport"><option value="0">No</option><option value="1">Yes</option></select>
      </div>
      <div class="question">
        <label>22. How often do you feel that you lack companionship?</label>
        <select id="oss1">
          <option value="1">Hardly ever</option>
          <option value="2">Some of the time</option>
          <option value="3">Often</option>
        </select>
        <label>23. How often do you feel left out?</label>
        <select id="oss2">
          <option value="1">Hardly ever</option>
          <option value="2">Some of the time</option>
          <option value="3">Often</option>
        </select>
        <label>24. How often do you feel isolated from others?</label>
        <select id="oss3">
          <option value="1">Hardly ever</option>
          <option value="2">Some of the time</option>
          <option value="3">Often</option>
        </select>
      </div>
    </fieldset>

    <!-- Intent to Engage in Care (Intent-to-Attend Scale) -->
    <fieldset>
      <legend>G. Intent to Engage in Care</legend>
      <p>For each statement below, please select the option that best describes your agreement <em>right now</em>.</p>
      <p style="font-size:0.9em; margin-top:-10px;">
        Scale: 1 = Strongly disagree,&nbsp; 2 = Disagree,&nbsp; 3 = Neutral/Unsure,&nbsp; 4 = Agree,&nbsp; 5 = Strongly agree
      </p>

      <!-- Attitude -->
      <label>1. Completing the follow-up appointments recommended to me would benefit my health.
        <select id="intent1">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </label>
      <!-- Subjective Norm -->
      <label>2. People who are important to me would support me in attending follow-up visits.
        <select id="intent3">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </label>

      <!-- Perceived Behavioral Control -->
      <label>3. I feel confident I can attend follow-up appointments even if it is inconvenient.
        <select id="intent5">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </label>
      <label>4. Transportation or scheduling issues will <strong>not</strong> prevent me from attending appointments.
        <select id="intent6">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </label>

      <!-- Behavioral Intention -->
      <label>5. I intend to attend all recommended follow-up appointments.
        <select id="intent7">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </label>

      <!-- NEW follow-through and feedback questions -->
      <label>6. How likely are you to follow through on the recommendations provided today?
        <select id="intent9">
          <option value="1">1 – Not at all likely</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 – Extremely likely</option>
        </select>
      </label>

      <label>7. Which recommendation do you feel will be most beneficial for you?
        <input type="text" id="intentBenefit" placeholder="Type your answer here" style="width:100%;" />
      </label>

      <label>8. Is there any other referral or recommendation that would be helpful but wasn’t provided or listed?
        <input type="text" id="intentOther" placeholder="Type your suggestion here" style="width:100%;" />
      </label>
    </fieldset>

    <!-- Barriers & Safety Risks -->
    <fieldset>
      <legend>H. Barriers &amp; Safety Risks</legend>

      <p style="font-size:0.9em;">These questions help us understand and reduce any risks that could interfere with your care or safety. Please answer Yes or No.</p>

      <!-- Violence / Harm to Others (adapted from HCR-20 and community violence literature) -->
      <h4 style="margin-bottom:4px;">Risk of Harm to Others</h4>
      <label>a. In the past month, have you had serious thoughts about physically harming someone? 
        <select id="harmOthers"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>b. Do you currently have access to a gun or other lethal weapon at home or work? 
        <select id="weaponAccess"><option value="0">No</option><option value="1">Yes</option></select>
      </label>

      <!-- Opioid Overdose Risk (WHO/CDC overdose risk factors) -->
      <h4 style="margin-bottom:4px;">Opioid Overdose Risk</h4>
      <label>c. Have you <strong>ever</strong> had an opioid overdose that required Narcan (naloxone) or hospital care? 
        <select id="odHistory"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>d. In the past 3&nbsp;months, have you used opioids together with alcohol, benzodiazepines, or sleeping pills? 
        <select id="odPoly"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>e. Do you currently have naloxone (Narcan) available or know where to get it quickly? 
        <select id="odNaloxone"><option value="0">No</option><option value="1">Yes</option></select>
      </label>

      <!-- Intimate Partner / Community Violence (brief HITS / danger assessment items) -->
      <h4 style="margin-bottom:4px;">Threats or Violence from Others</h4>
      <label>f. Are you currently afraid of a partner, ex-partner, or someone else in your life? 
        <select id="threatFear"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>g. In the past year, has a partner ever hit, slapped, kicked, or otherwise physically hurt you? 
        <select id="ipvPhysical"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
      <label>h. Have you been forced to have sexual activities against your will in the past year? 
        <select id="ipvSexual"><option value="0">No</option><option value="1">Yes</option></select>
      </label>
    </fieldset>

    <!-- Delayed Recall Entry -->
    <fieldset id="recallBlock" style="margin-top:20px;">
      <legend>Word Recall</legend>
      <p>Please type the three words you were asked to remember earlier:</p>
      <input type="text" id="recall1" placeholder="Word 1" style="margin-right:10px;" />
      <input type="text" id="recall2" placeholder="Word 2" style="margin-right:10px;" />
      <input type="text" id="recall3" placeholder="Word 3" />
    </fieldset>

    <!-- Action buttons -->
    <button class="btn no-print" id="calcBtn">Calculate &amp; Show Results</button>
    <button class="btn no-print" id="printBtn" disabled>Print / Save as PDF</button>

    <!-- Help & References -->
    <details class="no-print" style="margin-top:20px;">
      <summary><strong>Help • References • Scoring Guide</strong></summary>
      <p>This integrated questionnaire combines validated ultra-brief instruments:</p>
      <ul>
        <li><strong>AUDIT-C</strong> – Bush K et al., 1998</li>
        <li><strong>NIDA Quick Drug Screen</strong> – Smith PC et al., 2010</li>
        <li><strong>PHQ-2 / PHQ-9</strong> – Kroenke K &amp; Spitzer RL, 2003</li>
        <li><strong>GAD-2</strong> – Kroenke K et al., 2007</li>
        <li><strong>PC-PTSD-5</strong> – Prins A et al., 2016</li>
        <li><strong>SF-1</strong> – Ware J &amp; Sherbourne CD, 1992</li>
        <li><strong>PEG-3</strong> – Krebs EE et al., 2009</li>
        <li><strong>SARC-F</strong> – Malmstrom TK et al., 2013</li>
        <li><strong>Katz Index of Independence in ADLs</strong> – Katz S et al., 1963</li>
        <li><strong>Hunger Vital Sign™</strong> – Hager ER et al., 2010</li>
        <li><strong>PRAPARE</strong> Social Risk Items – NACHC, 2016</li>
        <li><strong>UCLA Loneliness Scale (OSS-3)</strong> – Hughes ME et al., 2004</li>
      </ul>
      <p>Cut-points and interpretation are shown in the “Screening Summary” after calculation.</p>
    </details>

    <!-- Results display -->
    <div id="results" style="display:none;"></div>

  <script>
    function positive(flag) { return flag ? 1 : 0; }

    // NEW: safely get integer value of an input/select by id; returns 0 if element missing or blank
    function getInt(id) {
      const el = document.getElementById(id);
      return el ? parseInt(el.value || 0) || 0 : 0;
    }

    function calculateResults() {
      const sex = document.querySelector('input[name="sex"]:checked');
      if (!sex) { alert('Please select sex at birth.'); return; }
      const isMale = sex.value === 'male';

      // AUDIT-C
      const auditScore = [audit1, audit2, audit3].reduce((s, el) => s + parseInt(el.value), 0);
      const auditPositive = auditScore >= (isMale ? 4 : 3);

      // NIDA
      const nidaPositive = parseInt(nida.value) >= 1;

      // Toggle SIP-DU block
      const sipDuBlock = document.getElementById('sipDuBlock');
      if (nidaPositive) {
        sipDuBlock.classList.remove('hidden');
        document.getElementById('substanceBlock').classList.remove('hidden');
      } else {
        sipDuBlock.classList.add('hidden');
        document.getElementById('substanceBlock').classList.add('hidden');
      }

      let sipDuScore = 0;
      if (!sipDuBlock.classList.contains('hidden')) {
        sipDuScore = ['sip1','sip2','sip3','sip4','sip5']
          .map(id => parseInt(document.getElementById(id).value || 0))
          .reduce((s,v)=>s+v,0);
      }

      // Substance list
      let substanceList = [];
      if (!document.getElementById('substanceBlock').classList.contains('hidden')) {
        const map = [
          ['sub1','Cannabis'],['sub2','Cocaine'],['sub3','Rx stimulants'],['sub4','Methamphetamine'],
          ['sub5','Inhalants'],['sub6','Sedatives'],['sub7','Hallucinogens'],['sub8','Street opioids'],['sub9','Rx opioids']
        ];
        map.forEach(([id,label])=>{ if(document.getElementById(id).checked) substanceList.push(label); });
        if(document.getElementById('subOther').checked){
          const txt=document.getElementById('otherText').value.trim();
          substanceList.push(txt?`Other: ${txt}`:'Other');
        }
      }

      // PHQ-2 & GAD-2
      const phqScore = parseInt(phq1.value) + parseInt(phq2.value);
      const phqPositive = phqScore >= 3;
      const gadScore = parseInt(gad1.value) + parseInt(gad2.value);
      const gadPositive = gadScore >= 3;

      // PC-PTSD-5
      const ptsdScore = [ptsd1, ptsd2, ptsd3, ptsd4, ptsd5].reduce((s, el) => s + parseInt(el.value), 0);
      const ptsdPositive = ptsdScore >= 3;

      // SF-1
      const sfPositive = parseInt(sf1.value) >= 4; // Fair or Poor

      // PEG-3
      const pegMean = (parseFloat(peg1.value) + parseFloat(peg2.value) + parseFloat(peg3.value)) / 3;
      const pegPositive = pegMean >= 5;

      // Housing
      const housingPositive = parseInt(housing.value) >= 1;

      // Food insecurity
      const foodPositive = parseInt(food1.value) >= 1 || parseInt(food2.value) >= 1;

      // Transportation barrier
      const transportPositive = parseInt(transport.value) >= 1;

      // OSS-3 loneliness
      const ossScore = parseInt(oss1.value) + parseInt(oss2.value) + parseInt(oss3.value);
      const ossPositive = ossScore >= 6;

      // SARC-F score
      const sarcF = ['sarc1','sarc2','sarc3','sarc4','sarc5'].reduce((s,id)=>s+parseInt(document.getElementById(id).value||0),0);
      const sarcPositive = sarcF>=4;
      const visionFlag = parseInt(document.getElementById('vision').value)===1;
      const hearingFlag = parseInt(document.getElementById('hearing').value)===1;
      const hygieneFlag = parseInt(document.getElementById('hygiene').value)===1;
      const sleepBad = parseInt(document.getElementById('sleepQ').value)===1;
      const malnutFlag = parseInt(document.getElementById('weightLoss').value)||parseInt(document.getElementById('meals').value);
      const adlScore = ['adl1','adl2','adl3','adl4','adl5','adl6'].reduce((s,id)=>s+parseInt(document.getElementById(id).value||0),0);
      const adlPositive = adlScore<=4;

      const positives = [auditPositive, nidaPositive, phqPositive, gadPositive, ptsdPositive, sfPositive, pegPositive, housingPositive, foodPositive, transportPositive, ossPositive, sarcPositive, visionFlag, hearingFlag, hygieneFlag, sleepBad, malnutFlag, adlPositive];
      const positiveCount = positives.filter(Boolean).length;

      // Tier interpretation
      let recommendation;
      if (positiveCount <= 1) recommendation = 'Standard brief advice & preventive education';
      else if (positiveCount <= 3) recommendation = 'Brief Negotiated Interview + targeted referral';
      else recommendation = 'Warm hand-off to Integrated Care / Psychiatry / Social Work';

      // Ensure PHQ-9 stays hidden (removed from workflow)
      const phq9Block = document.getElementById('phq9Block');
      if(phq9Block) phq9Block.classList.add('hidden');

      // PHQ-9 total if visible
      let phq9Total = phqScore;
      if (!phq9Block.classList.contains('hidden')) {
        phq9Total += ['phq3','phq4','phq5','phq6','phq7','phq8','phq9']
          .map(id => parseInt(document.getElementById(id).value || 0))
          .reduce((s,v)=>s+v,0);
      }

      // ASQ risk evaluation
      const asqYes = ['asq1','asq2','asq3','asq4'].some(id => parseInt(document.getElementById(id).value||0) === 1);
      const asq5El = document.getElementById('asq5');
      const asqNow = asq5El && !document.getElementById('asq5wrap').classList.contains('hidden') ? parseInt(asq5El.value)===1 : false;
      let asqRisk='';
      if(asqYes){
        if(asqNow) asqRisk='High – Current suicidal thoughts. Immediate safety plan / emergency eval.';
        else asqRisk='Positive ASQ screen. Complete safety plan & urgent mental-health referral.';
      } else {
        asqRisk='Negative ASQ screen.';
      }

      // Orientation auto-scoring
      function normalizeTxt(t){return t.trim().toLowerCase();}
      const now=new Date();
      const yearOK = parseInt(document.getElementById('orientYear').value)==now.getFullYear()?1:0;
      const monthInp = normalizeTxt(document.getElementById('orientMonth').value);
      const monthNum = parseInt(monthInp);
      const monthNames=['january','february','march','april','may','june','july','august','september','october','november','december'];
      const monthOK = (!isNaN(monthNum)? (monthNum===now.getMonth()+1): (monthNames[now.getMonth()].startsWith(monthInp)))?1:0;
      const dowInp = normalizeTxt(document.getElementById('orientDOW').value);
      const dowNames=['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
      const dowOK = dowNames[now.getDay()].startsWith(dowInp)?1:0;
      const recallWords=['apple','table','penny'];
      const recallScore=['recall1','recall2','recall3']
        .map((id,i)=> normalizeTxt(document.getElementById(id).value)===recallWords[i]?1:0)
        .reduce((s,v)=>s+v,0);
      const sisScore = yearOK+monthOK+dowOK+recallScore;
      const sisPositive = sisScore<=4;
      const errors = parseInt(document.getElementById('attErrors').value)||0;
      const attentionFlag = errors>=3;

      // C-SSRS risk evaluation
      let cssrsRisk = '';
      const cssrsBlockEl = document.getElementById('cssrsBlock');
      if (cssrsBlockEl && !cssrsBlockEl.classList.contains('hidden')) {
        const c1 = getInt('cssrs1');
        const c2 = getInt('cssrs2');
        const c3 = getInt('cssrs3');
        const c4 = getInt('cssrs4');
        const c5 = getInt('cssrs5');
        const c6 = getInt('cssrs6');
        if (c6 || c5 || c4) {
          cssrsRisk = 'High – Active plan/intent or behavior. Requires immediate safety plan and emergency evaluation.';
        } else if (c2) {
          cssrsRisk = 'Moderate – Active suicidal thoughts. Complete safety plan and refer for urgent mental-health evaluation.';
        } else if (c1) {
          cssrsRisk = 'Low – Passive death wish. Provide 988 resources and monitor.';
        } else {
          cssrsRisk = 'No suicidal ideation reported.';
        }
      }

      // Display results
      const resDiv = document.getElementById('results');
      resDiv.innerHTML = `<h2>Screening Summary</h2>
        <p><strong>Total Positive Screens:</strong> ${positiveCount}</p>
        <ul>
          <li>AUDIT-C: ${auditScore} ${auditPositive ? '(Positive)' : '(Negative)'}</li>
          <li>NIDA Drug Use: ${nidaPositive ? 'Positive' : 'Negative'}</li>
          ${sipDuBlock.classList.contains('hidden') ? '' : `<li>SIP-DU Consequences Endorsed: ${sipDuScore} / 5</li>`}
          ${substanceList.length?`<li>Lifetime substances used: ${substanceList.join(', ')}</li>`:''}
          ${asqRisk?`<li><strong>ASQ Result:</strong> ${asqRisk}</li>`:''}
          <li>Cognitive Quick Screen (SIS): ${sisScore} / 6 ${sisPositive?'(Positive)':'(Negative)'} — Letter Cancellation errors: ${errors}${attentionFlag?' (Impaired)':''}</li>
          ${cssrsRisk?`<li><strong>C-SSRS Risk:</strong> ${cssrsRisk}</li>`:''}
          <li><strong>Physical & Functional:</strong> SARC-F ${sarcF}${sarcPositive?' (Positive)':''}; Vision ${visionFlag?'Issue':'OK'}; Hearing ${hearingFlag?'Issue':'OK'}; Hygiene ${hygieneFlag?'Issue':'OK'}; Katz ADL ${adlScore}/6${adlPositive?' (Dependent)':''}</li>
          <li>PHQ-2: ${phqScore} ${phqPositive ? '(Positive)' : '(Negative)'}</li>
          <li>GAD-2: ${gadScore} ${gadPositive ? '(Positive)' : '(Negative)'}</li>
          ${phq9Block.classList.contains('hidden') ? '' : `<li>PHQ-9 Total: ${phq9Total}</li>`}
          <li>PC-PTSD-5: ${ptsdScore} ${ptsdPositive ? '(Positive)' : '(Negative)'}</li>
          <li>General Health: ${sf1.options[sf1.selectedIndex].text} ${sfPositive ? '(Flag)' : ''}</li>
          <li>PEG-3 Mean: ${pegMean.toFixed(1)} ${pegPositive ? '(Flag)' : ''}</li>
          <li>Housing Status: ${housing.options[housing.selectedIndex].text} ${housingPositive ? '(Flag)' : ''}</li>
          <li>Food Insecurity: ${foodPositive ? 'Positive' : 'Negative'}</li>
          <li>Transportation Barrier: ${transportPositive ? 'Positive' : 'Negative'}</li>
          <li>Loneliness (OSS-3): ${ossScore} ${ossPositive ? '(Positive)' : '(Negative)'}</li>
        </ul>
        <p><strong>Recommended Next Step:</strong> ${recommendation}</p>`;
      resDiv.style.display = 'block';
      document.getElementById('printBtn').disabled = false;
    }

    document.getElementById('calcBtn').addEventListener('click', calculateResults);
    // Real-time toggle for SIP-DU
    function toggleSipDu() {
      const show = parseInt(document.getElementById('nida').value) >= 1;
      document.getElementById('sipDuBlock').classList.toggle('hidden', !show);
      document.getElementById('substanceBlock').classList.toggle('hidden', !show);
    }
    // Toggle CSSRS detail questions
    function toggleCssrsDetail() {
      const trigger = document.getElementById('cssrs2');
      const detail = document.getElementById('cssrsDetail');
      if (!trigger || !detail) return; // guard if elements are absent
      const show = parseInt(trigger.value) === 1;
      detail.classList.toggle('hidden', !show);
    }

    // Toggle C-SSRS block based on PHQ-2 score ≥3 OR PHQ-9 item 9 >0
    function toggleCssrs() {
      const phq1v = getInt('phq1');
      const phq2v = getInt('phq2');
      const phq2Score = phq1v + phq2v;
      const phq9El = document.getElementById('phq9');
      const phq9Flag = phq9El ? parseInt(phq9El.value || 0) > 0 : false;
      const show = phq2Score >= 3 || phq9Flag;

      const cssrsBlock = document.getElementById('cssrsBlock');
      if (!cssrsBlock) return; // block not present – nothing to toggle
      cssrsBlock.classList.toggle('hidden', !show);
      if (show) {
        toggleCssrsDetail();
      }
    }
    document.addEventListener('change', (e)=>{
      if(e.target && (e.target.id==='phq1'||e.target.id==='phq2')) toggleCssrs();
      if(e.target && (e.target.id==='asq1'||e.target.id==='asq2'||e.target.id==='asq3'||e.target.id==='asq4')) toggleAsq5();
      if(e.target && e.target.id==='cssrs2') toggleCssrsDetail();
    });
    // ASQ toggle function
    function toggleAsq5(){
      const anyYes=['asq1','asq2','asq3','asq4'].some(id=>parseInt(document.getElementById(id).value||0)===1);
      document.getElementById('asq5wrap').classList.toggle('hidden', !anyYes);
    }
    toggleAsq5();

    // Letter cancellation timer
    document.getElementById('startLetterTask').addEventListener('click',()=>{
      const grid=document.getElementById('letterGrid');
      const msg=document.getElementById('timerMsg');
      grid.style.display='inline-block';
      msg.textContent='20s';
      let remaining=20;
      const interval=setInterval(()=>{
        remaining--; msg.textContent=remaining+'s';
        if(remaining<=0){ clearInterval(interval); grid.style.display='none'; msg.textContent='Time\'s up'; }
      },1000);
    });

    document.getElementById('printBtn').addEventListener('click', () => window.print());
  </script>
</body>
</html> 