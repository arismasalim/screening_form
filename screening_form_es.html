<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cuestionario Integrado Biopsicosocial (10 minutos)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f7f7;
    }
    h1 { text-align: center; }
    fieldset {
      border: 1px solid #ccc;
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
    }
    legend { font-weight: bold; }
    label { display:block; margin: 8px 0 4px; }
    select, input[type="number"], input[type="text"], input[type="radio"] { margin-right:10px; }
    .question{ margin-bottom:10px; }
    .btn{ padding:10px 20px; background:#0073e6; color:#fff; border:none; border-radius:4px; cursor:pointer; margin-right:10px; }
    .btn:disabled{ background:#999; }
    #results{ margin-top:20px; padding:15px; background:#e8f4ff; border:1px solid #0073e6; }
    .hidden{ display:none; }
    @media print{ .no-print{ display:none;} body{ background:#fff;} }
  </style>
</head>
<body>
  <h1>Cuestionario Integrado Biopsicosocial – 10 minutos</h1>
  <p>ID del paciente: <input type="text" id="patientId" /> Fecha: <input type="date" id="screenDate" /></p>

  <!-- Demografía -->
  <fieldset>
    <legend>Demografía</legend>
    <div class="question">
      <label>Sexo al nacer:</label>
      <label><input type="radio" name="sex" value="male" /> Masculino</label>
      <label><input type="radio" name="sex" value="female" /> Femenino</label>
    </div>
  </fieldset>

  <!-- Sección A: Consumo de sustancias -->
  <fieldset>
    <legend>A. Consumo de sustancias</legend>
    <div class="question">
      <label>1. ¿Con qué frecuencia consume alguna bebida que contenga alcohol?</label>
      <select id="audit1">
        <option value="0">Nunca</option>
        <option value="1">Mensualmente o menos</option>
        <option value="2">2–4 veces al mes</option>
        <option value="3">2–3 veces por semana</option>
        <option value="4">4 o más veces por semana</option>
      </select>
    </div>
    <div class="question">
      <label>2. ¿Cuántas bebidas estándar con alcohol consume en un día típico?</label>
      <select id="audit2">
        <option value="0">1–2</option>
        <option value="1">3–4</option>
        <option value="2">5–6</option>
        <option value="3">7–9</option>
        <option value="4">10 o más</option>
      </select>
    </div>
    <div class="question">
      <label>3. ¿Con qué frecuencia consume seis o más bebidas en una sola ocasión?</label>
      <select id="audit3">
        <option value="0">Nunca</option>
        <option value="1">Menos de una vez al mes</option>
        <option value="2">Mensualmente</option>
        <option value="3">Semanalmente</option>
        <option value="4">Diariamente o casi diariamente</option>
      </select>
    </div>
    <div class="question">
      <label>4. En el último año, ¿cuántas veces ha consumido una droga ilegal o un medicamento recetado con fines no médicos <em>(por ejemplo, por la sensación que le provocaba)</em>?</label>
      <select id="nida">
        <option value="0">0 veces</option>
        <option value="1">1 o más veces</option>
      </select>
    </div>

    <!-- SIP-DU seguimiento (muestra solo si NIDA es positivo) -->
    <div id="sipDuBlock" class="hidden" style="margin-top:10px;">
      <p><strong>Seguimiento (SIP-DU – Consecuencias del consumo de drogas):</strong> ¿Alguna vez ha experimentado alguno de los siguientes problemas debido a su consumo de drogas? (Seleccione Sí o No para cada uno)</p>
      <label>a. ¿No cumplió con responsabilidades habituales (trabajo, escuela, hogar)?</label>
      <select id="sip1"><option value="0">No</option><option value="1">Sí</option></select>
      <label>b. ¿Tuvo discusiones o problemas con familiares, amigos o compañeros?</label>
      <select id="sip2"><option value="0">No</option><option value="1">Sí</option></select>
      <label>c. ¿Se puso en situaciones de riesgo de salir lastimado/a (p. ej., conducir bajo efectos)?</label>
      <select id="sip3"><option value="0">No</option><option value="1">Sí</option></select>
      <label>d. ¿Continuó usando drogas aunque le causaban problemas de salud, legales o sociales?</label>
      <select id="sip4"><option value="0">No</option><option value="1">Sí</option></select>
      <label>e. ¿Ha querido o intentado reducir o dejar de usar drogas pero no pudo?</label>
      <select id="sip5"><option value="0">No</option><option value="1">Sí</option></select>
    </div>

    <!-- Lista de sustancias de por vida -->
    <div id="substanceBlock" class="hidden" style="margin-top:10px;">
      <p><strong>¿Cuál de las siguientes sustancias ha consumido alguna vez en su vida?</strong> <em>(Marque todas las que correspondan; solo uso no médico*)</em></p>
      <label><input type="checkbox" id="sub1" /> a. Cannabis (marihuana, hash)</label>
      <label><input type="checkbox" id="sub2" /> b. Cocaína (coca, crack)</label>
      <label><input type="checkbox" id="sub3" /> c. Estimulantes recetados* (Ritalin, Adderall, pastillas para dieta)</label>
      <label><input type="checkbox" id="sub4" /> d. Metanfetamina (cristal, ice)</label>
      <label><input type="checkbox" id="sub5" /> e. Inhalantes (nitruro, pegamento, gasolina)</label>
      <label><input type="checkbox" id="sub6" /> f. Sedantes o pastillas para dormir* (Valium, Xanax)</label>
      <label><input type="checkbox" id="sub7" /> g. Alucinógenos (LSD, hongos, éxtasis)</label>
      <label><input type="checkbox" id="sub8" /> h. Opioides de la calle (heroína, opio)</label>
      <label><input type="checkbox" id="sub9" /> i. Opioides recetados* (fentanilo, oxicodona, hidrocodona)</label>
      <label><input type="checkbox" id="subOther" /> j. Otro—especifique: <input type="text" id="otherText" placeholder="Sustancia" style="width:150px;" /></label>
      <p style="font-size:0.9em;">*Solo uso no médico.</p>
    </div>
  </fieldset>

  <!-- Sección B: Salud mental -->
  <fieldset>
    <legend>B. Salud mental</legend>
    <div class="question">
      <label>Durante las últimas 2 semanas, ¿con qué frecuencia le han molestado los siguientes problemas?</label>
      <label>5. Poco interés o placer en hacer cosas</label>
      <select id="phq1">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>6. Sentirse decaído/a, deprimido/a o sin esperanza</label>
      <select id="phq2">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>7. Sentirse nervioso/a, ansioso/a o al límite</label>
      <select id="gad1">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>8. No poder parar o controlar la preocupación</label>
      <select id="gad2">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
    </div>

    <!-- Bloque PHQ-9 -->
    <div id="phq9Block" class="hidden">
      <p><strong>Preguntas adicionales (PHQ-9):</strong> Durante las últimas 2 semanas, ¿con qué frecuencia le han molestado…</p>
      <label>9. Dificultad para conciliar o mantener el sueño, o dormir demasiado</label>
      <select id="phq3">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>10. Sentirse cansado/a o con poca energía</label>
      <select id="phq4">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>11. Poca hambre o comer en exceso</label>
      <select id="phq5">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>12. Sentirse mal consigo mismo/a — o sentirse un fracaso o haber defraudado a su familia</label>
      <select id="phq6">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>13. Dificultad para concentrarse, por ejemplo al leer el periódico o ver la televisión</label>
      <select id="phq7">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>14. Moverse o hablar tan despacio que otras personas podrían haberlo notado, o lo contrario — estar tan inquieto/a o agitado/a que se mueve mucho más de lo habitual</label>
      <select id="phq8">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
      <label>15. Pensamientos de que estaría mejor muerto/a o de hacerse daño de alguna manera</label>
      <select id="phq9">
        <option value="0">Nada en absoluto</option>
        <option value="1">Varios días</option>
        <option value="2">Más de la mitad de los días</option>
        <option value="3">Casi todos los días</option>
      </select>
    </div>
  </fieldset>

  <!-- Sección C: Trauma / PTSD -->
  <fieldset>
    <legend>C. Trauma / TEPT</legend>
    <p>¿Alguna vez ha vivido un evento tan aterrador, horrible o angustiante que, en el último mes…</p>
    <div class="question">
      <label>9. ¿Tuvo pesadillas o pensó en el evento cuando no quería?</label>
      <select id="ptsd1"><option value="0">No</option><option value="1">Sí</option></select>
    </div>
    <div class="question">
      <label>10. ¿Intentó no pensar en ello o evitó situaciones que se lo recordaban?</label>
      <select id="ptsd2"><option value="0">No</option><option value="1">Sí</option></select>
    </div>
    <div class="question">
      <label>11. ¿Estuvo constantemente en alerta, vigilante o fácilmente sobresaltado/a?</label>
      <select id="ptsd3"><option value="0">No</option><option value="1">Sí</option></select>
    </div>
    <div class="question">
      <label>12. ¿Se sintió entumecido/a o desconectado/a de la gente, actividades o su entorno?</label>
      <select id="ptsd4"><option value="0">No</option><option value="1">Sí</option></select>
    </div>
    <div class="question">
      <label>13. ¿Se sintió culpable o incapaz de dejar de culparse a sí mismo/a u a otros por el evento o los problemas que causó?</label>
      <select id="ptsd5"><option value="0">No</option><option value="1">Sí</option></select>
    </div>
  </fieldset>

  <!-- Sección D: Salud física & dolor -->
  <fieldset>
    <legend>D. Salud física & dolor</legend>
    <div class="question">
      <label>14. En general, ¿diría que su salud es:</label>
      <select id="sf1">
        <option value="1">Excelente</option>
        <option value="2">Muy buena</option>
        <option value="3">Buena</option>
        <option value="4">Regular</option>
        <option value="5">Mala</option>
      </select>
    </div>
    <div class="question">
      <label>Escala de dolor PEG-3 (0 = sin dolor / no interfiere, 10 = peor dolor / interfiere totalmente)</label>
      <label>15. Intensidad de dolor (promedio última semana)</label>
      <input type="number" id="peg1" min="0" max="10" value="0" />
      <label>16. Interferencia del dolor con disfrute de la vida</label>
      <input type="number" id="peg2" min="0" max="10" value="0" />
      <label>17. Interferencia del dolor con la actividad general</label>
      <input type="number" id="peg3" min="0" max="10" value="0" />
    </div>
  </fieldset>

  <!-- Sección E: Determinantes sociales -->
  <fieldset>
    <legend>E. Determinantes sociales & funcionamiento</legend>
    <div class="question">
      <label>18. ¿Dónde durmió la mayoría de las noches en el último mes?</label>
      <select id="housing">
        <option value="0">Vivienda estable (propia/alquiler)</option>
        <option value="1">Temporal (albergue, hotel, casa de conocidos)</option>
        <option value="2">Sin techo (calle, vehículo, carpa)</option>
      </select>
    </div>
    <div class="question">
      <label>19. En los últimos 12 meses, nos preocupaba que la comida se acabara antes de tener dinero para comprar más.</label>
      <select id="food1">
        <option value="0">Nunca cierto</option>
        <option value="1">A veces cierto</option>
        <option value="1">Frecuentemente cierto</option>
      </select>
    </div>
    <div class="question">
      <label>20. En los últimos 12 meses, la comida que compramos no alcanzó y no tuvimos dinero para conseguir más.</label>
      <select id="food2">
        <option value="0">Nunca cierto</option>
        <option value="1">A veces cierto</option>
        <option value="1">Frecuentemente cierto</option>
      </select>
    </div>
    <div class="question">
      <label>21. En los últimos 12 meses, ¿la falta de transporte le impidió acudir a citas médicas, trabajo o conseguir lo que necesitaba?</label>
      <select id="transport"><option value="0">No</option><option value="1">Sí</option></select>
    </div>
    <div class="question">
      <label>22. ¿Con qué frecuencia siente que le falta compañía?</label>
      <select id="oss1">
        <option value="1">Casi nunca</option>
        <option value="2">Algunas veces</option>
        <option value="3">A menudo</option>
      </select>
      <label>23. ¿Con qué frecuencia se siente excluido/a?</label>
      <select id="oss2">
        <option value="1">Casi nunca</option>
        <option value="2">Algunas veces</option>
        <option value="3">A menudo</option>
      </select>
      <label>24. ¿Con qué frecuencia se siente aislado/a de los demás?</label>
      <select id="oss3">
        <option value="1">Casi nunca</option>
        <option value="2">Algunas veces</option>
        <option value="3">A menudo</option>
      </select>
    </div>
  </fieldset>

  <button class="btn no-print" id="calcBtn">Calcular &amp; Mostrar resultados</button>
  <button class="btn no-print" id="printBtn" disabled>Imprimir / Guardar PDF</button>

  <!-- Ayuda & Referencias -->
  <details class="no-print" style="margin-top:20px;">
    <summary><strong>Ayuda • Referencias • Guía de puntuación</strong></summary>
    <p>Este cuestionario combina instrumentos validados ultra-breves:</p>
    <ul>
      <li><strong>AUDIT-C</strong> – Bush K et al., 1998</li>
      <li><strong>Cribado rápido NIDA</strong> – Smith PC et al., 2010</li>
      <li><strong>PHQ-2 / PHQ-9</strong> – Kroenke K & Spitzer RL, 2003</li>
      <li><strong>GAD-2</strong> – Kroenke K et al., 2007</li>
      <li><strong>PC-PTSD-5</strong> – Prins A et al., 2016</li>
      <li><strong>SF-1</strong> – Ware J & Sherbourne CD, 1992</li>
      <li><strong>PEG-3</strong> – Krebs EE et al., 2009</li>
      <li><strong>Hunger Vital Sign™</strong> – Hager ER et al., 2010</li>
      <li><strong>PRAPARE</strong> – NACHC, 2016</li>
      <li><strong>Escala de Soledad UCLA-3</strong> – Hughes ME et al., 2004</li>
    </ul>
    <p>Los puntos de corte e interpretación se muestran en el resumen después del cálculo.</p>
  </details>

  <!-- Resultados -->
  <div id="results" style="display:none;"></div>

  <script>
    function calculateResults() {
      const sex = document.querySelector('input[name="sex"]:checked');
      if (!sex) { alert('Seleccione sexo al nacer.'); return; }
      const isMale = sex.value === 'male';

      const auditScore = [audit1, audit2, audit3].reduce((s, el) => s + parseInt(el.value), 0);
      const auditPositive = auditScore >= (isMale ? 4 : 3);
      const nidaPositive = parseInt(nida.value) >= 1;

      // Mostrar/ocultar bloque SIP-DU
      const sipDuBlock = document.getElementById('sipDuBlock');
      if (nidaPositive) sipDuBlock.classList.remove('hidden');
      else sipDuBlock.classList.add('hidden');

      // También mostrar lista de sustancias
      const subBlock=document.getElementById('substanceBlock');
      if(nidaPositive) subBlock.classList.remove('hidden');
      else subBlock.classList.add('hidden');

      let sipDuScore = 0;
      if (!sipDuBlock.classList.contains('hidden')) {
        sipDuScore = ['sip1','sip2','sip3','sip4','sip5']
          .map(id => parseInt(document.getElementById(id).value || 0))
          .reduce((s,v)=>s+v,0);
      }

      // Lista de sustancias
      let substanceList=[];
      if(!subBlock.classList.contains('hidden')){
        const mapa=[
          ['sub1','Cannabis'],['sub2','Cocaína'],['sub3','Estimulantes Rx'],['sub4','Metanfetamina'],
          ['sub5','Inhalantes'],['sub6','Sedantes'],['sub7','Alucinógenos'],['sub8','Opioides callejeros'],['sub9','Opioides Rx']
        ];
        mapa.forEach(([id,label])=>{if(document.getElementById(id).checked) substanceList.push(label);});
        if(document.getElementById('subOther').checked){
          const txt=document.getElementById('otherText').value.trim();
          substanceList.push(txt?`Otro: ${txt}`:'Otro');
        }
      }

      const phqScore = parseInt(phq1.value) + parseInt(phq2.value);
      const phqPositive = phqScore >= 3;

      const gadScore = parseInt(gad1.value) + parseInt(gad2.value);
      const gadPositive = gadScore >= 3;

      // Mostrar/ocultar bloque PHQ-9
      const phq9Block = document.getElementById('phq9Block');
      if (phqPositive) phq9Block.classList.remove('hidden');
      else phq9Block.classList.add('hidden');

      let phq9Total = phqScore;
      if (!phq9Block.classList.contains('hidden')) {
        phq9Total += ['phq3','phq4','phq5','phq6','phq7','phq8','phq9']
          .map(id => parseInt(document.getElementById(id).value || 0))
          .reduce((s,v)=>s+v,0);
      }

      const ptsdScore = [ptsd1,ptsd2,ptsd3,ptsd4,ptsd5].reduce((s,el)=>s+parseInt(el.value),0);
      const ptsdPositive = ptsdScore >= 3;

      const sfPositive = parseInt(sf1.value) >= 4;
      const pegMean = (parseFloat(peg1.value)+parseFloat(peg2.value)+parseFloat(peg3.value))/3;
      const pegPositive = pegMean >= 5;

      const housingPositive = parseInt(housing.value) >= 1;
      const foodPositive = parseInt(food1.value)>=1 || parseInt(food2.value)>=1;
      const transportPositive = parseInt(transport.value)>=1;
      const ossScore = parseInt(oss1.value)+parseInt(oss2.value)+parseInt(oss3.value);
      const ossPositive = ossScore >= 6;

      const positives = [auditPositive,nidaPositive,phqPositive,gadPositive,ptsdPositive,sfPositive,pegPositive,housingPositive,foodPositive,transportPositive,ossPositive];
      const positiveCount = positives.filter(Boolean).length;

      let recommendation;
      if (positiveCount<=1) recommendation = 'Consejo breve y educación preventiva';
      else if (positiveCount<=3) recommendation = 'Entrevista breve negociada + derivación dirigida';
      else recommendation = 'Derivación inmediata a atención integrada / psiquiatría / trabajo social';

      const resDiv = document.getElementById('results');
      resDiv.innerHTML = `<h2>Resumen del cribado</h2>
        <p><strong>Total de áreas positivas:</strong> ${positiveCount}</p>
        <ul>
          <li>AUDIT-C: ${auditScore} ${auditPositive?'(Positivo)':'(Negativo)'}</li>
          <li>Uso de drogas (NIDA): ${nidaPositive?'Positivo':'Negativo'}</li>
          ${sipDuBlock.classList.contains('hidden')?'':`<li>Consecuencias SIP-DU: ${sipDuScore} / 5</li>`}
          ${substanceList.length?`<li>Sustancias consumidas en la vida: ${substanceList.join(', ')}</li>`:''}
          <li>PHQ-2: ${phqScore} ${phqPositive?'(Positivo)':'(Negativo)'}</li>
          <li>GAD-2: ${gadScore} ${gadPositive?'(Positivo)':'(Negativo)'}</li>
          ${phq9Block.classList.contains('hidden')?'':`<li>PHQ-9 total: ${phq9Total}</li>`}
          <li>PC-PTSD-5: ${ptsdScore} ${ptsdPositive?'(Positivo)':'(Negativo)'}</li>
          <li>Salud general: ${sf1.options[sf1.selectedIndex].text} ${sfPositive?'(Bandera)':''}</li>
          <li>Media PEG-3: ${pegMean.toFixed(1)} ${pegPositive?'(Bandera)':''}</li>
          <li>Situación de vivienda: ${housing.options[housing.selectedIndex].text} ${housingPositive?'(Bandera)':''}</li>
          <li>Inseguridad alimentaria: ${foodPositive?'Positiva':'Negativa'}</li>
          <li>Barrera de transporte: ${transportPositive?'Positiva':'Negativa'}</li>
          <li>Soledad (OSS-3): ${ossScore} ${ossPositive?'(Positivo)':'(Negativo)'}</li>
        </ul>
        <p><strong>Próximo paso recomendado:</strong> ${recommendation}</p>`;
      resDiv.style.display='block';
      document.getElementById('printBtn').disabled=false;
    }

    document.getElementById('calcBtn').addEventListener('click',calculateResults);
    // Mostrar/ocultar SIP-DU en tiempo real
    function toggleSipDu(){
      const show = parseInt(document.getElementById('nida').value) >= 1;
      document.getElementById('sipDuBlock').classList.toggle('hidden', !show);
      document.getElementById('substanceBlock').classList.toggle('hidden', !show);
    }
    document.getElementById('nida').addEventListener('change',toggleSipDu);
    toggleSipDu();
    document.getElementById('printBtn').addEventListener('click',()=>window.print());
  </script>
</body>
</html> 